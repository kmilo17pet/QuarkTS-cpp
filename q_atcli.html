<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="QuarkTS++ OS" />
<meta property="og:image" content="https://user-images.githubusercontent.com/11412210/235049017-242f1c64-52ef-46db-8008-2c3d8a578320.png" />
<meta property="og:description" content="An open-source OS for small embedded applications" />
<meta property="og:url" content="https://github.com/kmilo17pet/QuarkTS-cpp" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>OS: AT Command Line Interface (CLI)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/kmilo17pet/QuarkTS-cpp" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="quarktslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OS
   &#160;<span id="projectnumber">v1.7.0</span>
   </div>
   <div id="projectbrief">Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('q_atcli.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">AT Command Line Interface (CLI)</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#q_atcli_overview">Overview</a></li>
<li class="level1"><a href="#q_atcli_components">The components of the CLI</a></li>
<li class="level1"><a href="#q_atcli_syntax">Supported syntax</a></li>
<li class="level1"><a href="#q_atcli_setup">Setting up an AT-CLI instance</a></li>
<li class="level1"><a href="#q_atcli_sub_commands">Subscribing commands to the parser</a></li>
<li class="level1"><a href="#q_atcli_cmd_callback">Writing a command callback</a></li>
<li class="level1"><a href="#q_atcli_inputh">Handling the input</a></li>
<li class="level1"><a href="#q_atcli_run">Running the CLI parser</a></li>
<li class="level1"><a href="#q_atcli_example1">A CLI example</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="q_atcli_overview"></a>
Overview</h1>
<p>A command-line interface (CLI) is a way to interact directly with the software of an embedded system in the form of text commands and responses. It can be seen as a typed set of commands to produce a result, but here, the commands are typed in real-time by a user through a specific interface, for example, UART, USB, LAN, etc.</p>
<p>A CLI is often developed to aid initial driver development and debugging. This CLI might become the interface (or one of the interfaces) used by a sophisticated end-user to interact with the product. Think of typing commands to control a machine, or perhaps for low-level access to the control system as a development tool, tweaking time-constants and monitoring low-level system performance during testing.</p>
<h1><a class="anchor" id="q_atcli_components"></a>
The components of the CLI</h1>
<p>The provided development API parses and handles input commands, following a simplified form of the extended AT-commands syntax.</p>
<center>  
<!DOCTYPE html>
<html>
<head>
<title>atcli</title>
<meta charset="utf-8"/>
</head>
<body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;zoom&quot;:1.5,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; modified=\&quot;2022-10-19T19:31:39.234Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36\&quot; etag=\&quot;iXCP-aXpe9eB9d0tPXyv\&quot; version=\&quot;20.4.1\&quot; type=\&quot;google\&quot;&gt;&lt;diagram id=\&quot;o9YKW9kYFg2IcPfcP6fb\&quot; name=\&quot;Página-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
</body>
</html>
 <em>AT CLI implementation</em> </center><p>As seen in the figure, the CLI has a few components described below:</p>
<ul>
<li><b>Input Handler</b> : It is responsible for collecting incoming data from the input in the form of ASCII characters inside a buffer. When this buffer is ready by receiving an EOL(End-Of-Line) byte, it notifies the validator to perform the initial checks.</li>
<li><b>Validator</b> : Take the input string and perform three checks over it:<ol type="1">
<li>The input matches one of the subscribed commands.</li>
<li>The input matches one of the default commands.</li>
<li>The input is unknown</li>
</ol>
</li>
<li><b>Pre-Parser</b> : Takes the input if the validator asserts the first check. It is responsible for syntax validation and classification. Also, prepares the input argument for the next component.</li>
<li><b>Callback or Post-Parser</b> : If input at the pre-parser is valid, the respective command callback is invoked. Here, the application writer is free to handle the command execution and the output response.</li>
<li><b>Output printer</b> : Takes all the return status of the previous components to print out a response at the output.</li>
</ul>
<dl class="section remark"><dt>Remarks</dt><dd>Here, <em>Input</em> and <em>Output</em> should be provided by the application writer, for example, if a UART interface is chosen, the input should take the received bytes from an ISR and the output is a function to print out a single byte.</dd></dl>
<h1><a class="anchor" id="q_atcli_syntax"></a>
Supported syntax</h1>
<p>The syntax is straightforward and the rules are provided below:</p>
<ul>
<li>All command lines must start with AT and end with an <code>EOL</code> character. By default, the CLI uses the carriage return character. (We will use <code>CR</code> to represent a carriage return character in this document).</li>
<li>AT commands are case-insensitive</li>
<li>Only four types of AT commands are allowed:<ul>
<li>Acting (<code>cli::commandType::ACT</code>) : This is the simplest type of commands that can be subscribed. It's normally used to execute the action that the command should do. This type does not take arguments or modifiers, for example : <code>AT+CMD</code> </li>
<li>Read (<code>cli::commandType::READ</code>) : This type of command allows you to read or test a value already configured for the specified parameter. Only one argument is allowed. for example <code>"AT+CMD?"</code> or <code>"AT+CMD?PARAM1"</code> </li>
<li>Test (<code>cli::commandType::TEST</code>) : These types of commands allow you to get the values that can be set for its parameters. No parameters are allowed here. Example <code>"AT+CMD=?"</code> </li>
<li>Parameter Set (<code>cli::commandType::PARA</code>) : These types of commands allow n arguments to be passed for setting parameters, for example: <code>AT+CMD=x</code>,y If none of the types is given at the input, the command response will be <code>ERROR</code> </li>
</ul>
</li>
<li>The possible output responses are:<ul>
<li><code>OK:</code> Indicates the successful execution of the command.</li>
<li><code>ERROR:</code> A generalized message to indicate failure in executing the command.</li>
<li><code>UNKNOWN</code> : The input command is not subscribed.</li>
<li><code>NOT ALLOWED</code> : The command syntax is not one of the allowed types.</li>
<li>User-defined: A custom output message defined by the application writer.</li>
<li><code>NONE</code> : No response.</li>
</ul>
</li>
</ul>
<p>All responses are followed by a <code>CR</code> <code>LF</code> </p>
<p>Errors generated during the execution of these AT commands could be due to the following reasons:</p><ul>
<li>Incorrect syntax/parameters of the AT command</li>
<li>Bad parameters or not allowed operations defined by the application writer.</li>
</ul>
<p>In case of an error, the string <code>ERROR</code> or <code>"ERROR:&lt;error_no&gt;"</code> are displayed.</p>
<h1><a class="anchor" id="q_atcli_setup"></a>
Setting up an AT-CLI instance</h1>
<p>Before starting the CLI development, the corresponding instance must be defined; a variable of class <a class="el" href="classq_o_s_1_1command_line_interface.html" title="An AT Command Line Interface (CLI) object.">qOS::commandLineInterface</a>. The instance should be initialized using the <a class="el" href="classq_o_s_1_1command_line_interface.html#ac14307ef47fc8707faf51681812d0679" title="Setup an instance of the AT Command Line Interface.">qOS::commandLineInterface::setup()</a> method.</p>
<h1><a class="anchor" id="q_atcli_sub_commands"></a>
Subscribing commands to the parser</h1>
<p>The AT CLI is able to subscribe to any number of custom AT commands. For this, the <a class="el" href="classq_o_s_1_1command_line_interface.html#abee8123d61fa0982d3e913fc4851f0c7" title="This function subscribes the CLI instance to a specific command with an associated Callback function,...">qOS::commandLineInterface::add()</a> method should be used.</p>
<p>This function subscribes the CLI instance to a specific command with an associated callback function, so that the next time the required command is sent to the CLI input, the callback function will be executed. The CLI parser only analyzes commands that follow the simplified AT-Commands syntax already described.</p>
<h1><a class="anchor" id="q_atcli_cmd_callback"></a>
Writing a command callback</h1>
<p>The command callback should be coded by the application writer. Here, the following prototype should be used:</p>
<div class="fragment"><div class="line">cli::response CMD_Callback( cli::handler_t h ) {</div>
<div class="line">    <span class="comment">/* TODO : The command callback */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The callback takes one argument of type <a class="el" href="classq_o_s_1_1cli_1_1handler__t.html" title="The command argument with all the regarding information of the incoming AT command.">qOS::cli::handler_t</a> and returns a single value. The input argument it's just a pointer to public data of the CLI instance where the command it subscribed to. From the callback context, can be used to print out extra information as a command response, parse the command parameters, and query properties with crucial information about the detected command, like the type, the number of arguments, and the subsequent string after the command text. To see more details please check the <a class="el" href="classq_o_s_1_1cli_1_1handler__t.html" title="The command argument with all the regarding information of the incoming AT command.">qOS::cli::handler_t</a> class reference.</p>
<p>The return value (an enum of type <a class="el" href="group__qatcli.html#gaa827a463743265d6ebe6bb3618f63bf2" title="an enumeration to define the possible values that can be returned from the callback of a command.">qOS::cli::response</a> ) determines the response shown by the Output printer component. The possible allowed values are:</p>
<ul>
<li><code>cli::response::OK</code> : as expected, print out the OK string.</li>
<li><code>cli::response::ERROR</code> : as expected, print out the ERROR string.</li>
<li><code>cli::ERROR_CODE(no)</code> : Used to indicate an error code. This code is defined by the application writer and should be a value between <code>1</code> and <code>32766</code>. For example, a return value of <code>cli::ERROR_CODE(15)</code>, will print out the string <code>ERROR:15</code>.</li>
<li><code>cli::response::NO_RESPONSE</code> : No response will be printed out.</li>
</ul>
<p>A simple example of how the command callback should be coded is shown below:</p>
<div class="fragment"><div class="line">cli::response CMD_Callback( cli::handler_t h ) {</div>
<div class="line">    cli::response Response = cli::response::NO_RESPONSE;</div>
<div class="line">    <span class="keywordtype">int</span> arg1 = 0;</div>
<div class="line">    <span class="keywordtype">float</span> arg2 = 0;</div>
<div class="line">    <span class="comment">/*check the command-type*/</span></div>
<div class="line">    <span class="keywordflow">switch</span> ( h.getType() ) {</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::PARA:</div>
<div class="line">            <span class="keywordflow">if</span> ( h.getNumArgs() &gt; 0 ) {</div>
<div class="line">                 arg1 = h.getArgInt( 1 ); <span class="comment">/*get the first argument as integer*/</span></div>
<div class="line">                 <span class="keywordflow">if</span> ( h.getNumArgs() &gt; 1 ) {</div>
<div class="line">                     arg2 = h.getArgFlt( 2 ); <span class="comment">/*get the second argument as float*/</span></div>
<div class="line">                     sprintf( h.output, <span class="stringliteral">&quot;arg1 = %d arg2 = %f&quot;</span>, arg1, arg2 );</div>
<div class="line">                     Response = cli::response::NO_RESPONSE;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                 Response = cli::response::ERROR;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::TEST:</div>
<div class="line">            h.writeOut( <span class="stringliteral">&quot;inmediate message&quot;</span> );</div>
<div class="line">            Response = cli::response::OK;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::READ:</div>
<div class="line">            strcpy( h.output , <span class="stringliteral">&quot;Test message after the callback&quot;</span> );</div>
<div class="line">            Response = cli::response::OK;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::ACT:</div>
<div class="line">            Response = cli::response::OK;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            Response = cli::response::ERROR;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> Response;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="q_atcli_inputh"></a>
Handling the input</h1>
<p>Input handling is simplified using the provided methods of this class. The <a class="el" href="classq_o_s_1_1command_line_interface.html#a8c70e232920a3b771b064a9ded969a5a" title="Feed the CLI input with a single character. This call is mandatory from an interrupt context....">qOS::commandLineInterface::isrHandler()</a> function are intended to be used from the interrupt context. This avoids any kind of polling implementation and allows the CLI application to be designed using an event-driven pattern.</p>
<p>The two overloads for this method feed the parser input, the first one with a single character and the second with a string. The application writer should call one of these functions from the desired hardware interface, for example, from a UART receive ISR.</p>
<p>If there is no intention to feed the input from the ISR context, the methods <a class="el" href="classq_o_s_1_1command_line_interface.html#a0dc01a8f99c2d0b67448fbf926667491" title="Sends a command to the Command Line Interface instance.">qOS::commandLineInterface::raise()</a> or <a class="el" href="classq_o_s_1_1command_line_interface.html#a1c3b2f43317b8b4fca1b4ae38ed0d755" title="Try to execute the requested command.">qOS::commandLineInterface::exec()</a> can be called at demand from the base context. As expected, both functions send the string to the specified CLI. The difference between both methods is that <a class="el" href="classq_o_s_1_1command_line_interface.html#a0dc01a8f99c2d0b67448fbf926667491" title="Sends a command to the Command Line Interface instance.">qOS::commandLineInterface::raise()</a> sends the command through the input, marking it as ready for parsing and acting as the Input handler component.</p>
<p>The <a class="el" href="classq_o_s_1_1command_line_interface.html#a1c3b2f43317b8b4fca1b4ae38ed0d755" title="Try to execute the requested command.">qOS::commandLineInterface::exec()</a>, on the other hand, executes the components of Pre-parsing and Postparsing bypassing the other components, including the Output printer, so that it must be handled by the application writer.</p>
<dl class="section note"><dt>Note</dt><dd>All functions involved with the component Input-handler, ignores non-graphic characters and cast any uppercase to lowercase.</dd></dl>
<h1><a class="anchor" id="q_atcli_run"></a>
Running the CLI parser</h1>
<p>The parser can be invoked directly using the <a class="el" href="classq_o_s_1_1command_line_interface.html#a6791acfb53adfa6b1002d6e293ed3efd" title="Run the AT Command Line Interface when the input is ready.">qOS::commandLineInterface::run()</a> method. Almost all the components that make up the CLI are performed by this method, except for the Input Handler, which should be managed by the application writer itself.</p>
<p>In this way, the writer of the application must implement the logic that leads this function to be called when the input-ready condition is given.</p>
<p>The simple approach for this is to check the return value of any of the input feeder APIs and set a notification variable when they report a ready input. Later in the base context, a polling job should be performed over this notification variable, running the parser when their value is true, then clearing the value after to avoid unnecessary overhead.</p>
<p>The recommended implementation is to leave this job handled by a task instead of coding the logic to know when the CLI should run. For this, an overload of <a class="el" href="classq_o_s_1_1core.html#a882991afb9548674668aa51dbe694d6e" title="Add a task to the scheduling scheme. The task is scheduled to run every t time units,...">qOS::core::add()</a> is provided accepting an instance of the CLI. This overload adds a task to the scheduling scheme running an AT Command Line Interface and is treated as an event-triggered task. The address of the parser instance will be stored in the <code>TaskData</code> storage-Pointer.</p>
<p>After invoked, both CLI and task are linked together in such a way that when an input-ready condition is given, a notification event is sent to the task launching the CLI components. As the task is event-triggered, there is no additional overhead and the writer of the application can assign a priority value to balance the application against other tasks in the scheduling scheme.</p>
<h1><a class="anchor" id="q_atcli_example1"></a>
A CLI example</h1>
<p>The following example demonstrates the usage of a simple command-line interface using the UART peripheral with two subscribed commands :</p><ul>
<li>A command to write and read the state of a GPIO pin <code>"at+gpio"</code>.</li>
<li><p class="startli">A command to retrieve the compilation timestamp <code>"at+info"</code>. First, let's get started defining the required objects to set up the CLI instance:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CLI_MAX_INPUT_BUFF_SIZE         ( 128 )</span></div>
<div class="line"><span class="preprocessor">#define CLI_MAX_OUTPUT_BUFF_SIZE        ( 128 )</span></div>
<div class="line"> </div>
<div class="line">task CLI_Task;</div>
<div class="line">commandLineInterface CLI_Object;</div>
<div class="line">cli::command AT_GPIO, AT_INFO;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> CLI_Input[ CLI_MAX_INPUT_BUFF_SIZE ];</div>
<div class="line"><span class="keywordtype">char</span> CLI_Output[ CLI_MAX_OUTPUT_BUFF_SIZE ];</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*Command callbacks*/</span></div>
<div class="line">cli::response AT_GPIO_Callback( cli::handler_t h );</div>
<div class="line">cli::response AT_INFO_Callback( cli::handler_t h );</div>
</div><!-- fragment --></li>
</ul>
<p>Then the CLI instance is configured by subscribing commands and adding the task to the OS. A wrapper function is required here to make the UART output-function compatible with the CLI API.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> CLI_OutputChar_Wrapper( <span class="keywordtype">void</span> *sp, <span class="keyword">const</span> <span class="keywordtype">char</span> c ) { <span class="comment">/*CLI output function*/</span></div>
<div class="line">    (void)sp; <span class="comment">/*unused*/</span></div>
<div class="line">    HAL_UART_WriteChar( UART1, c );</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">void</span> ) {</div>
<div class="line">    HAL_Setup();</div>
<div class="line">    os.<a class="code hl_function" href="classq_o_s_1_1core.html#a8a1c57e7736a22fb8036bfa60b96915c">init</a>( HAL_GetTick, <span class="keyword">nullptr</span> );</div>
<div class="line">    CLI_Object.setup( BSP_UART_PUTC, CLI_Input, <span class="keyword">sizeof</span>(CLI_Input),</div>
<div class="line">                      CLI_Output, <span class="keyword">sizeof</span>(CLI_Output) );</div>
<div class="line"> </div>
<div class="line">    CLI_Object.add( AT_GPIO, <span class="stringliteral">&quot;at+gpio&quot;</span>, AT_GPIO_Callback,</div>
<div class="line">                    QATCLI_CMDTYPE_ACT | QATCLI_CMDTYPE_READ |</div>
<div class="line">                    QATCLI_CMDTYPE_TEST | QATCLI_CMDTYPE_PARA | 0x22 );</div>
<div class="line">    CLI_Object.add( AT_INFO, <span class="stringliteral">&quot;at+info&quot;</span>, AT_INFO_Callback,</div>
<div class="line">                    QATCLI_CMDTYPE_ACT );</div>
<div class="line">    os.<a class="code hl_function" href="classq_o_s_1_1core.html#a882991afb9548674668aa51dbe694d6e">add</a>( CLI_Task, CLI_Object, core::LOWEST_PRIORITY );</div>
<div class="line">    os.<a class="code hl_function" href="classq_o_s_1_1core.html#a30b4c1ac78976e2d289a710647300d5c">run</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassq_o_s_1_1core_html_a30b4c1ac78976e2d289a710647300d5c"><div class="ttname"><a href="classq_o_s_1_1core.html#a30b4c1ac78976e2d289a710647300d5c">qOS::core::run</a></div><div class="ttdeci">bool run(void) noexcept</div><div class="ttdoc">Executes the scheduling scheme. It must be called once after the task pool has been defined.</div></div>
<div class="ttc" id="aclassq_o_s_1_1core_html_a882991afb9548674668aa51dbe694d6e"><div class="ttname"><a href="classq_o_s_1_1core.html#a882991afb9548674668aa51dbe694d6e">qOS::core::add</a></div><div class="ttdeci">bool add(task &amp;Task, taskFcn_t callback, const priority_t p, const duration_t t, const iteration_t n, const taskState s=taskState::ENABLED_STATE, void *arg=nullptr) noexcept</div><div class="ttdoc">Add a task to the scheduling scheme. The task is scheduled to run every t time units,...</div></div>
<div class="ttc" id="aclassq_o_s_1_1core_html_a8a1c57e7736a22fb8036bfa60b96915c"><div class="ttname"><a href="classq_o_s_1_1core.html#a8a1c57e7736a22fb8036bfa60b96915c">qOS::core::init</a></div><div class="ttdeci">bool init(const getTickFcn_t tFcn=nullptr, taskFcn_t callbackIdle=nullptr) noexcept</div><div class="ttdoc">Task Scheduler initialization. This core method is required and must be called once in the applicatio...</div></div>
</div><!-- fragment --><p>The CLI input is feeded from the interrupt context by using the UART receive ISR:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> interrupt HAL_UART_RxInterrupt( <span class="keywordtype">void</span> ) {</div>
<div class="line">    <span class="keywordtype">char</span> received;</div>
<div class="line"> </div>
<div class="line">    received = HAL_HUART_GetChar( UART1 );</div>
<div class="line">    CLI_Object.isrHandler( received ); <span class="comment">/*Feed the CLI input*/</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, the command callbacks are later defined to perform the requested operations.</p>
<div class="fragment"><div class="line">cli::response AT_GPIO_Callback( cli::handler_t h ) {</div>
<div class="line">    cli::response RetValue = cli::response::ERROR;</div>
<div class="line">    <span class="keywordtype">int</span> pin, value;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> ( h.getType() ) {</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::ACT: <span class="comment">/*&lt; AT+gpio */</span></div>
<div class="line">            RetValue = cli::response::OK;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::TEST: <span class="comment">/*&lt; AT+gpio=? */</span></div>
<div class="line">            h.writeOut( <span class="stringliteral">&quot;+gpio=&lt;pin&gt;,&lt;value&gt;\r\n&quot;</span> );</div>
<div class="line">            h.writeOut( <span class="stringliteral">&quot;+gpio?\r\n&quot;</span> );</div>
<div class="line">            RetValue = cli::response::NO_RESPONSE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::READ: <span class="comment">/*&lt; AT+gpio? */</span></div>
<div class="line">            sprintf( h.Output, <span class="stringliteral">&quot;0x%08X&quot;</span>, HAL_GPIO_Read( GPIOA ) );</div>
<div class="line">            RetValue = cli::response::NO_RESPONSE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::PARA: <span class="comment">/*&lt; AT+gpio=&lt;pin&gt;,&lt;value&gt; */</span></div>
<div class="line">            pin = h.getArgInt( 1 );</div>
<div class="line">            value = h.getArgInt( 2 );</div>
<div class="line">            HAL_GPIO_WRITE( GPIOA, pin, value );</div>
<div class="line">            RetValue = cli::response::OK;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        default : <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> RetValue;</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line">cli::response AT_INFO_Callback( cli::handler_t h ) {</div>
<div class="line">    cli::response RetValue = cli::response::ERROR;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> ( param.getType() ) {</div>
<div class="line">        <span class="keywordflow">case</span> cli::commandType::ACT: <span class="comment">/*&lt; AT+info */</span></div>
<div class="line">            util::strcpy( h.output, <span class="stringliteral">&quot;Compilation: &quot;</span> __DATE__ <span class="stringliteral">&quot; &quot;</span> __TIME__ );</div>
<div class="line">            RetValue = cli::response::NO_RESPONSE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        default :</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> RetValue;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="q_extensions.html">Extensions</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
