<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="QuarkTS++ OS" />
<meta property="og:image" content="https://user-images.githubusercontent.com/11412210/235049017-242f1c64-52ef-46db-8008-2c3d8a578320.png" />
<meta property="og:description" content="An open-source OS for small embedded applications" />
<meta property="og:url" content="https://github.com/kmilo17pet/QuarkTS-cpp" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>OS: Getting started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/kmilo17pet/QuarkTS-cpp" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="quarktslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OS
   &#160;<span id="projectnumber">v1.3.5</span>
   </div>
   <div id="projectbrief">Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('q_gettingstarted.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting started </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#q_getos">Getting the OS</a><ul><li class="level2"><a href="#q_cloneos">Cloning QuarkTS++</a></li>
<li class="level2"><a href="#q_submodule">Including QuarkTS++ as a git sub-module</a></li>
<li class="level2"><a href="#q_getqconfig">Get a copy of the OS configuration file</a></li>
</ul>
</li>
<li class="level1"><a href="#q_firststeps">First steps</a></li>
<li class="level1"><a href="#q_os_demo">Two simple demonstrative examples</a><ul><li class="level2"><a href="#q_os_example1">A simple scheduling</a></li>
<li class="level2"><a href="#q_os_example2">Using the task argument</a></li>
</ul>
</li>
<li class="level1"><a href="#qarduinousage">Using QuarkTS++ in Arduino</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="q_getos"></a>
Getting the OS</h1>
<p >Download the latest release from the official repository :</p>
<p ><a href="https://github.com/kmilo17pet/QuarkTS-cpp/releases" style="font-weight:bold">QuarkTS++ Releases</a></p>
<p >Unpack the release package and add the sources files to your project.</p>
<h2><a class="anchor" id="q_cloneos"></a>
Cloning QuarkTS++</h2>
<p >You only need to clone the <code>main</code> branch as follows:</p>
<div class="fragment"><div class="line">git clone https://github.com/kmilo17pet/QuarkTS-cpp</div>
</div><!-- fragment --><h2><a class="anchor" id="q_submodule"></a>
Including QuarkTS++ as a git sub-module</h2>
<p >Add the OS kernel as a submodule to your project:</p>
<div class="fragment"><div class="line">git submodule add https://github.com/kmilo17pet/QuarkTS-cpp.git &lt;destination path&gt;</div>
</div><!-- fragment --><p >Then, run the initialize command to fetch the code for the first time:</p>
<div class="fragment"><div class="line">git submodule update --init</div>
</div><!-- fragment --><p >To update the submodule to the latest just run:</p>
<div class="fragment"><div class="line">git submodule update --remote</div>
</div><!-- fragment --><h2><a class="anchor" id="q_getqconfig"></a>
Get a copy of the OS configuration file</h2>
<p >The file <code><a class="el" href="config_8h_source.html">config.h</a></code> provides specific <a class="el" href="q_foundations.html#q_configmacros">Configuration macros</a> to customize several aspects of the OS. In order to build your solution with QuarkTS++, you should provided your own copy of this configuration file. You can obtain a copy with the default configuration by issuing the following command:</p>
<h1><a class="anchor" id="q_firststeps"></a>
First steps</h1>
<p >Include the source files to your project. Also, make sure you add a copy of the file <code><a class="el" href="config_8h_source.html">config.h</a></code> and modify it according to your needs. Setup your compiler including the path of the OS directory. Include the header file <code><a class="el" href="_quark_t_s_8h_source.html">QuarkTS.h</a></code> and setup the instance of the kernel using the <a class="el" href="classq_o_s_1_1core.html#a76bcdcfaba5020967caff19f69f4270a" title="Task Scheduler initialization. This core method is required and must be called once in the applicatio...">qOS::core::init()</a> inside the main thread to initialize te kernel, specify the reference clock and the idle-task ( see <a class="el" href="q_foundations.html#q_timmingapproach">Timing Approach</a>). Additional configuration to the target compiler may be required to add the path to the directory of header files. The code below shows a common initialization procedure in the main source file.</p>
<p >File <code>main.c</code> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;QuarkTS.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceq_o_s.html">qOS</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main( <span class="keywordtype">void</span> ) {</div>
<div class="line">    <span class="comment">//device startup with hardware-specific code</span></div>
<div class="line">    HardwareSetup();</div>
<div class="line">    Configure_Periodic_Timer_Interrupt_1ms();</div>
<div class="line">    <span class="comment">//end of device startup with hardware-specific code</span></div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a76bcdcfaba5020967caff19f69f4270a">init</a>( <span class="keyword">nullptr</span> , IdleTask_Callback );</div>
<div class="line">    <span class="comment">// TODO: add Tasks to the scheduler scheme and run the OS</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassq_o_s_1_1core_html_a76bcdcfaba5020967caff19f69f4270a"><div class="ttname"><a href="classq_o_s_1_1core.html#a76bcdcfaba5020967caff19f69f4270a">qOS::core::init</a></div><div class="ttdeci">void init(const getTickFcn_t tFcn=nullptr, taskFcn_t callbackIdle=nullptr) noexcept</div><div class="ttdoc">Task Scheduler initialization. This core method is required and must be called once in the applicatio...</div></div>
<div class="ttc" id="agroup__qtaskcreation_html_gaefc7088d1435e64e433d09541fae505c"><div class="ttname"><a href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">qOS::os</a></div><div class="ttdeci">core &amp; os</div><div class="ttdoc">The predefined instance of the OS kernel interface.</div></div>
<div class="ttc" id="anamespaceq_o_s_html"><div class="ttname"><a href="namespaceq_o_s.html">qOS</a></div><div class="ttdoc">OS/Kernel interfaces.</div><div class="ttdef"><b>Definition:</b> bytebuffer.hpp:7</div></div>
</div><!-- fragment --><p >In the above code, the following considerations should be taken:</p><ul>
<li>The function <code>os.init()</code> must be called before any interaction with the OS. Here, the <code>os</code> its an instance of the <a class="el" href="classq_o_s_1_1core.html" title="The class to interface the OS.">qOS::core</a> kernel interface.</li>
<li>The procedure <code>HardwareSetup()</code> should be a function with all the hardware instructions needed to initialize the target system.</li>
<li>The procedure <code>Configure_Periodic_Timer_Interrupt_1ms()</code> should be a function with all the hardware instructions needed to initialize and enable a timer with an overflow tick of one millisecond.</li>
</ul>
<p >Tasks can be later added to the scheduling scheme by simply calling <a class="el" href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b" title="Add a task to the scheduling scheme. The task is scheduled to run every t time units,...">qOS::core::addTask()</a> or any of the other available methods for specific purpose tasks.</p>
<h1><a class="anchor" id="q_os_demo"></a>
Two simple demonstrative examples</h1>
<h2><a class="anchor" id="q_os_example1"></a>
A simple scheduling</h2>
<p >This example demonstrates a simple environment setup for multiple tasks. Initially, only <code>task1</code> and <code>task2</code> are enabled. <code>task1</code> runs every 2 seconds 10 times and then stops. <code>task2</code> runs every 3 seconds indefinitely. <code>task1</code> enables <code>task3</code> at its first run. <code>task3</code> run every 5 seconds. <code>task1</code> disables <code>task3</code> on its last iteration and change <code>task2</code> to run every 1/2 seconds. In the end, <code>task2</code> is the only task running every 1/2 seconds.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;BSP.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;QuarkTS.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceq_o_s.html">qOS</a>;</div>
<div class="line"> </div>
<div class="line">task task1, task2, task3; <span class="comment">/*task nodes*/</span></div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> interrupt Timer0_ISR( <span class="keywordtype">void</span> ) {</div>
<div class="line">    clock::sysTick();</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> Task1_Callback( event_t e ) {</div>
<div class="line">    BSP_UART1_WriteString( e.thisTask().getName() );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( e.firstIteration() ) {</div>
<div class="line">        task3.setState( taskState::ENABLED );</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> ( e.lastIteration() ) {</div>
<div class="line">        e.thisTask().setState( taskState::SUSPENDED );</div>
<div class="line">        e.thisTask().setTime( 500 );</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> Task2_Callback( event_t e ) {</div>
<div class="line">    BSP_UART1_WriteString( e.thisTask().getName() );</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">void</span> Task3_Callback( event_t e ) {</div>
<div class="line">    BSP_UART1_WriteString( e.thisTask().getName() );</div>
<div class="line">}</div>
<div class="line"><span class="comment">/*==================================================================*/</span></div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">void</span> ) {</div>
<div class="line">    HardwareSetup();  <span class="comment">/*hardware initialization function*/</span></div>
<div class="line">    <span class="comment">/*function to fire an interrupt at 1ms - timer tick*/</span></div>
<div class="line">    Configure_Periodic_Timer0_Interrupt_1ms();</div>
<div class="line">    </div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a76bcdcfaba5020967caff19f69f4270a">init</a>( <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span> );</div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b">addTask</a>( Task1, Task1_Callback, core::MEDIUM_PRIORITY, 2_sec, 10, taskState::ENABLED );</div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b">addTask</a>( Task2, Task2_Callback, core::MEDIUM_PRIORITY, 3_sec, task::PERIODIC, taskState::ENABLED );</div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b">addTask</a>( Task2, Task3_Callback, core::MEDIUM_PRIORITY, 5_sec, task::PERIODIC, taskState::DISABLED );</div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a30b4c1ac78976e2d289a710647300d5c">run</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassq_o_s_1_1core_html_a30b4c1ac78976e2d289a710647300d5c"><div class="ttname"><a href="classq_o_s_1_1core.html#a30b4c1ac78976e2d289a710647300d5c">qOS::core::run</a></div><div class="ttdeci">bool run(void) noexcept</div><div class="ttdoc">Executes the scheduling scheme. It must be called once after the task pool has been defined.</div></div>
<div class="ttc" id="aclassq_o_s_1_1core_html_a615f44cfc4f4b4963b2b4cbb044ab76b"><div class="ttname"><a href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b">qOS::core::addTask</a></div><div class="ttdeci">bool addTask(task &amp;Task, taskFcn_t callback, const priority_t p, const duration_t t, const iteration_t n, const taskState s=taskState::ENABLED_STATE, void *arg=nullptr) noexcept</div><div class="ttdoc">Add a task to the scheduling scheme. The task is scheduled to run every t time units,...</div></div>
</div><!-- fragment --><h2><a class="anchor" id="q_os_example2"></a>
Using the task argument</h2>
<p >When adding tasks, they can accept a parameter of type pointer to void <code>void*</code> also called the storage pointer. This parameter could be used for multiple applications, including storage, task identification, duplication removal and others. The following example shows the usage of this argument to avoid callback duplication among tasks with the same behavior.</p>
<p >Consider a scenario where you have to build a digital controller for several physical variables, for example, a PID controller for temperature, humidity and light. The PID algorithm will be the same for all variables. The only difference will be the variable input, the controlled output action and the PID gains. In this case, each of the PID tasks will utilize the same callback methods. The only difference will be the I/O parameters (specific for each PID controller).</p>
<p >Let’s define a PID data structure with the I/O variables and gains.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">     qOS::time_t dt; <span class="comment">/*Controller Time Step*/</span></div>
<div class="line">     <span class="keywordtype">float</span> yt; <span class="comment">/*Measured variable (Controller Input)*/</span></div>
<div class="line">     <span class="keywordtype">float</span> ut; <span class="comment">/*Controlled variable (Controller Output)*/</span></div>
<div class="line">     <span class="keywordtype">float</span> ie; <span class="comment">/*Accumulated error*/</span></div>
<div class="line">     <span class="keywordtype">float</span> pe; <span class="comment">/*Previous error*/</span></div>
<div class="line">     <span class="keywordtype">float</span> sp; <span class="comment">/*Set-Point*/</span></div>
<div class="line">     <span class="keywordtype">float</span> Kc, Ki, Kd; <span class="comment">/*PID Gains*/</span></div>
<div class="line"> } PID_Params_t;</div>
<div class="line"> </div>
<div class="line"> PID_Params_t TemperatureControl = {</div>
<div class="line">    1.5_sec, <span class="comment">/*time step*/</span></div>
<div class="line">    0.0f, 0.0f, 0.0f, 0.0f, <span class="comment">/*Initial IO state of yt and ut*/</span></div>
<div class="line">    28.5f, <span class="comment">/*Set-Point*/</span></div>
<div class="line">    0.89f, 0.122f, 0.001f <span class="comment">/*Kc, Ki, Kd*/</span></div>
<div class="line"> };</div>
<div class="line"> PID_Params_t HumidityControl= {</div>
<div class="line">    1_sec, <span class="comment">/*time step*/</span></div>
<div class="line">    0.0f, 0.0f, 0.0f, 0.0f, <span class="comment">/*Initial IO state of yt and ut*/</span></div>
<div class="line">    60.0f, <span class="comment">/*Set-Point*/</span></div>
<div class="line">    2.5f, 0.2354f, 0.0015f <span class="comment">/*Kc, Ki, Kd*/</span></div>
<div class="line"> };</div>
<div class="line"> PID_Params_t LightControl= {</div>
<div class="line">    0.5_sec, <span class="comment">/*time step*/</span></div>
<div class="line">    0.0f, 0.0f, 0.0f, 0.0f, <span class="comment">/*Initial IO state of yt and ut*/</span></div>
<div class="line">    45.0f, <span class="comment">/*Set-Point*/</span></div>
<div class="line">    5.36f, 0.0891f, 0.0f <span class="comment">/*Kc, Ki, Kd*/</span></div>
<div class="line"> };</div>
</div><!-- fragment --><p >A task will be added to the scheme to collect the sensor data and apply the respective control output.</p>
<div class="fragment"><div class="line"><a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.AddTask( IO_TASK , IO_TASK_Callback , core::MEDIUM_PRIORITY , 100, task::PERIODIC, taskState::ENABLED_STATE , <span class="stringliteral">&quot;iotask&quot;</span> );</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> IO_TASK_Callback( event_t e ) {</div>
<div class="line">    TemperatureControl.yt = SampleTemperatureSensor();</div>
<div class="line">    HumidityControl.yt = SampleHumiditySensor();</div>
<div class="line">    LightControl.yt = SampleLightSensor();</div>
<div class="line">    WriteTemperatureActuatorValue( TemperatureControl.ut );</div>
<div class="line">    WriteHumidityActuatorValue( HumidityControl.ut );</div>
<div class="line">    WriteLightActuatorValue( LightControl.ut );</div>
<div class="line">}</div>
</div><!-- fragment --><p >Then, three different tasks are created to apply the respective PID controller. Note that these tasks refer to the same callback method and we assign pointers to the respective variables.</p>
<div class="fragment"><div class="line"><a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b">addTask</a>( TEMPERATURE_CONTROL_TASK, PIDControl_Callback,</div>
<div class="line">            core::HIGHEST_PRIORITY, TemperatureControl.dt ,</div>
<div class="line">            task::PERIODIC, taskState::ENABLED_STATE, &amp;TemperatureControl );</div>
<div class="line"><a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b">addTask</a>( HUMIDITY_CONTROL_TASK, PIDControl_Callback,</div>
<div class="line">            core::HIGHEST_PRIORITY, HumidityControl.dt,</div>
<div class="line">            task::PERIODIC, taskState::ENABLED_STATE, &amp;HumidityControl );</div>
<div class="line"><a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a615f44cfc4f4b4963b2b4cbb044ab76b">addTask</a>( LIGHT_CONTROL_TASK, PIDControl_Callback,</div>
<div class="line">            core::HIGHEST_PRIORITY, LightControl.dt,</div>
<div class="line">            task::PERIODIC, taskState::ENABLED_STATE, &amp;LightControl );</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> PIDControl_Callback( event_t e ) {</div>
<div class="line">    <span class="keywordtype">float</span> Error, derivative;</div>
<div class="line">    <span class="comment">/* Obtain the reference to the specific PID controller</span></div>
<div class="line"><span class="comment">     * using the TaskData field from the event_t structure</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    PID_Params_t *Controller = (PID_Params_t *)e.TaskData;</div>
<div class="line">    <span class="comment">/*Compute the error*/</span></div>
<div class="line">    Error = Controller-&gt;sp - Controller-&gt;yt;</div>
<div class="line">    <span class="comment">/*Compute the accumulated error using backward integral approximation*/</span></div>
<div class="line">    Controller-&gt;ie += <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( Error*Controller-&gt;dt )/1000.0f;</div>
<div class="line">    <span class="comment">/*update and compute the derivative term*/</span></div>
<div class="line">    derivative = ( Error - Controller-&gt;pe )/Controller-&gt;dt;</div>
<div class="line">    <span class="comment">/*update the previous error*/</span></div>
<div class="line">    Controller-&gt;pe = Error;</div>
<div class="line">    <span class="comment">/*compute the pid control law*/</span></div>
<div class="line">    Controller-&gt;ut = Controller-&gt;Kc*Error + Controller-&gt;Ki*Controller-&gt;ie + Controller-&gt;Kd*derivative;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="qarduinousage"></a>
Using QuarkTS++ in Arduino</h1>
<p >QuarkTS++ is widely compatible with most Arduino cores including 8bit architectures. To install the QuarkTS++ OS into your Arduino IDE you can use the Library Manager (available from IDE version 1.6.2). Open the IDE and click to the "Sketch" menu and then Include Library &gt; Manage Libraries.</p>
<p >Then the Library Manager will open and you will find a list of libraries that are already installed or ready for installation. Type in the search box "QuarkTS" and when listed, click the install button. Once it has finished, an Installed tag should appear next to the library. You can close the library manager.</p>
<p >You can now find the new library available in the Sketch &gt; Include Library menu.</p>
<p >When invoking the <code>os.init()</code> for the first time, make sure to pass the <code>millis</code> function as argument</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;QuarkTS.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceq_o_s.html">qOS</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> idleTask_Callback( event_t e ) {</div>
<div class="line">     <span class="comment">// TODO: add the idle activities</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a76bcdcfaba5020967caff19f69f4270a">init</a>( millis , IdleTask_Callback );</div>
<div class="line">    <span class="comment">// TODO: add Tasks to the scheduler scheme and run the OS</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_variable" href="group__qtaskcreation.html#gaefc7088d1435e64e433d09541fae505c">os</a>.<a class="code hl_function" href="classq_o_s_1_1core.html#a30b4c1ac78976e2d289a710647300d5c">run</a>();</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
